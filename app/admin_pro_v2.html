<!doctype html><html lang="en" data-theme="light"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Accounts Admin — Pro</title>
<style>
:root{--bg:#f7f9fc;--panel:#fff;--panel2:#f0f3fa;--text:#0b1222;--muted:#66758a;--border:#e2e8f0;--brand:#2563EB;--radius:14px}
[data-theme="dark"]{--bg:#0c1222;--panel:#0f162f;--panel2:#0b142a;--text:#e8eeff;--muted:#8ea1b9;--border:#1d2442;--brand:#5B8CFF}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:1220px;margin:18px auto;padding:0 16px}
.top{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:12px}
.brand{font-weight:800}.btn{border:1px solid var(--border);background:var(--panel2);color:var(--text);padding:8px 12px;border-radius:11px;cursor:pointer;font-weight:700}
.btn.primary{background:var(--brand);color:#fff;border-color:transparent}.btn.small{padding:6px 10px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius)}.card>.hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--border);font-weight:800}.card>.bd{padding:12px 14px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}.tabs .tab{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:var(--panel);cursor:pointer;font-weight:700}.tabs .tab.active{background:var(--brand);color:#fff;border-color:transparent}
.grid{display:grid;gap:16px;grid-template-columns:1fr}@media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}
.field{display:flex;flex-direction:column;gap:6px;margin-right:8px}input,select{background:var(--panel2);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px}
.kpis{display:grid;gap:10px;grid-template-columns:repeat(6,1fr)}.kpis .box{background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:10px}.kpis .num{font-weight:900;font-size:18px}
table{width:100%;border-collapse:collapse}th,td{padding:10px;border-bottom:1px solid var(--border)}th{font-size:12px;text-transform:uppercase;letter-spacing:.6px;text-align:left;color:var(--muted)}
.toast{position:fixed;right:18px;bottom:18px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px 12px;display:none}
dialog::backdrop{background:rgba(0,0,0,.25)}dialog{border:1px solid var(--border);border-radius:14px;background:var(--panel);color:var(--text);min-width:320px}
.code{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-family:ui-monospace,Consolas,Menlo,monospace;overflow:auto}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
</style></head><body>
<div class="wrap">
  <div class="top"><div class="brand">Accounts Admin — <span id="meBadge">guest</span></div>
    <div class="row"><button class="btn small" id="themeBtn">Theme</button><button class="btn small" id="loginBtn">Login</button><button class="btn small" id="logoutBtn" style="display:none">Logout</button></div></div>
  <div class="tabs"><div class="tab active" data-tab="overview">Overview</div><div class="tab" data-tab="users">Users</div><div class="tab" data-tab="keys">Keys</div><div class="tab" data-tab="grants">Grants</div><div class="tab" data-tab="docs">Endpoints</div></div>
  <div id="tab-overview" style="margin-top:10px">
    <div class="grid">
      <div class="card"><div class="hd">Stats</div><div class="bd">
        <div class="row"><div class="field"><label>From</label><input type="date" id="fromDate"></div><div class="field"><label>To</label><input type="date" id="toDate"></div><button class="btn small" id="refreshStats">Refresh</button></div>
        <div class="kpis" style="margin-top:12px">
          <div class="box"><div class="muted">Total Uploaded</div><div class="num" id="kUploaded">-</div></div>
          <div class="box"><div class="muted">Unused</div><div class="num" id="kUnused">-</div></div>
          <div class="box"><div class="muted">Used</div><div class="num" id="kUsed">-</div></div>
          <div class="box"><div class="muted">Locked</div><div class="num" id="kLocked">-</div></div>
          <div class="box"><div class="muted">Reg OK</div><div class="num" id="kReg">-</div></div>
          <div class="box"><div class="muted">Code 282</div><div class="num" id="k282">-</div></div>
        </div>
        <div style="margin-top:16px"><b>Owners</b>
          <table id="ownersTable"><thead><tr><th>Owner</th><th>Uploaded</th><th>Unused</th><th>Used</th><th>Locked</th><th>Reg OK</th><th>282</th><th>Pending</th></tr></thead><tbody></tbody></table>
        </div>
        <div style="margin-top:16px"><b>Per Consumer</b><table id="consumersTable"><thead><tr><th>Consumer</th><th>Used</th></tr></thead><tbody></tbody></table></div>
      </div></div>
      <div class="card"><div class="hd">Quick Actions</div><div class="bd">
        <div class="row"><div class="field"><label>Release pending (minutes)</label><input id="relMin" value="10" style="max-width:140px"></div><button class="btn small" id="btnRelease">Release now</button><label><input type="checkbox" id="autoRel"> Auto every N minutes</label></div>
        <div style="margin-top:12px" class="muted">Mark:
          <span class="row" style="margin-top:8px"><select id="markStatus"><option value="success">success</option><option value="code_282">code_282</option><option value="locked">locked</option></select>
          <input id="markId" placeholder="id (optional)"><input id="markEmail" placeholder="email (optional)"><button class="btn small" id="btnMark">Mark</button></span>
          <div class="muted" style="margin-top:6px">/v1/mark</div></div></div></div>
    </div></div>
  <div id="tab-users" class="tabpage" style="display:none;margin-top:10px"><div class="card"><div class="hd">Users (Owners) — aggregated</div><div class="bd"><button class="btn small" id="refreshUsers">Refresh</button>
    <table id="usersTable" style="margin-top:8px"><thead><tr><th>User</th><th>Uploaded</th><th>Unused</th><th>Used</th><th>Locked</th><th>Reg OK</th><th>282</th><th>Self</th><th>Others</th></tr></thead><tbody></tbody></table></div></div></div>
  <div id="tab-keys" class="tabpage" style="display:none;margin-top:10px"><div class="card"><div class="hd">Keys</div><div class="bd">
    <div class="row" style="margin-bottom:10px"><input id="newKeyId" placeholder="key_id"><input id="newKeyLabel" placeholder="label (optional)">
      <label><input id="newActive" type="checkbox" checked> active</label><label><input id="newUpload" type="checkbox" checked> can_upload</label><label><input id="newConsume" type="checkbox" checked> can_consume</label>
      <input id="newRPM" placeholder="rpm_limit" value="60" style="width:110px"><input id="newDaily" placeholder="daily_cap" value="5000" style="width:110px"><button class="btn small primary" id="btnCreateKey">Create</button>
      <input id="keySearch" placeholder="filter keys..." style="margin-left:auto;min-width:200px"></div>
    <table id="keysTable"><thead><tr><th>Key</th><th>Label</th><th>Active</th><th>Upload</th><th>Consume</th><th>RPM</th><th>Daily</th><th>Created</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div></div></div>
  <div id="tab-grants" class="tabpage" style="display:none;margin-top:10px"><div class="card"><div class="hd">Grants Matrix (Consumers × Owners)</div><div class="bd" id="grantsMatrix">Loading…</div></div></div>
  <div id="tab-docs" class="tabpage" style="display:none;margin-top:10px"><div class="card"><div class="hd">API Endpoints — copy & go</div><div class="bd" id="docsBox"></div></div></div>
</div>
<dialog id="loginDlg"><form method="dialog" style="padding:16px;min-width:340px"><h3 style="margin:0 0 10px 0">Admin Login</h3>
<div class="field"><label>Email</label><input id="li_email" placeholder="you@mail.com"/></div><div class="field"><label>Password</label><input id="li_pass" type="password" placeholder="********"/></div>
<div class="row" style="justify-content:flex-end;margin-top:10px"><button class="btn" value="cancel">Cancel</button><button class="btn primary" id="li_submit" value="ok">Login</button></div>
<div id="li_msg" class="muted" style="margin-top:8px"></div></form></dialog>
<div class="toast" id="toast"></div>
<script>
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s)), storage=localStorage;
const tabs=$$('.tab'); const pages={overview:$('#tab-overview'),users:$('#tab-users'),keys:$('#tab-keys'),grants:$('#tab-grants'),docs:$('#tab-docs')};
tabs.forEach(t=>t.onclick=()=>{tabs.forEach(x=>x.classList.remove('active'));t.classList.add('active');Object.values(pages).forEach(p=>p.style.display='none');pages[t.dataset.tab].style.display='block';});
$('#themeBtn').onclick=()=>{const d=document.documentElement;d.setAttribute('data-theme', d.getAttribute('data-theme')==='dark'?'light':'dark');storage.setItem('theme', d.getAttribute('data-theme'))};(function(){const th=storage.getItem('theme');if(th)document.documentElement.setAttribute('data-theme',th)})();
(function(){const to=new Date();const from=new Date(Date.now()-2*86400000);const f=d=>{d.setMinutes(d.getMinutes()-d.getTimezoneOffset());return d.toISOString().slice(0,10)};$('#fromDate').value=f(from);$('#toDate').value=f(to)})();
function toast(m,ms=1600){const t=$('#toast');t.textContent=m;t.style.display='block';clearTimeout(toast._t);toast._t=setTimeout(()=>t.style.display='none',ms)}
function xKey(){return storage.getItem('x_api_key')||''} function setKey(k){if(k)storage.setItem('x_api_key',k);$('#meBadge').textContent=k?'admin':'guest';$('#logoutBtn').style.display=k?'inline-flex':'none'}
$('#loginBtn').onclick=()=>$('#loginDlg').showModal(); $('#logoutBtn').onclick=()=>{storage.removeItem('x_api_key');setKey('');toast('Logged out')}
$('#li_submit').onclick=async(e)=>{e.preventDefault();$('#li_msg').textContent='';try{const email=$('#li_email').value.trim(),password=$('#li_pass').value;
  const r=await api('/v1/admin/login',{method:'POST',body:JSON.stringify({email,password})}); if(r&&r.admin_token){setKey(r.admin_token);$('#loginDlg').close();toast('Logged in');refreshAll();return;}throw new Error('login_failed')
}catch(err){$('#li_msg').textContent='Login failed: '+(err.message||'')}};
async function api(path,opt={}){const headers=Object.assign({'Content-Type':'application/json'},opt.headers||{});const key=xKey();if(key)headers['X-API-Key']=key;const r=await fetch(path,Object.assign({},opt,{headers}));const ct=r.headers.get('content-type')||'';if(!r.ok){let msg=await r.text().catch(()=>r.statusText);throw new Error(msg||r.statusText)}return ct.includes('application/json')?r.json():r.text()}
async function loadStats(){const from=$('#fromDate').value,to=$('#toDate').value;const data=await api(`/v1/stats?date_from=${from}&date_to=${to}`);const t=data.totals||{};$('#kUploaded').textContent=t.uploaded??'-';$('#kUnused').textContent=t.unused??'-';$('#kUsed').textContent=t.used_total??'-';$('#kLocked').textContent=t.locked??'-';$('#kReg').textContent=t.reg_success??'-';$('#k282').textContent=t.code_282??'-';
  const ot=$('#ownersTable tbody');ot.innerHTML='';(data.per_owner||[]).forEach(o=>{const tr=document.createElement('tr');tr.innerHTML=`<td><b>${o.owner_key_id||o.owner||''}</b></td><td>${o.uploaded||0}</td><td>${o.unused||0}</td><td>${o.used_total||0}</td><td>${o.locked||0}</td><td>${o.reg_success||0}</td><td>${o.code_282||0}</td><td>${o.used_pending||0}</td>`;ot.appendChild(tr)});
  const ct=$('#consumersTable tbody');ct.innerHTML='';(data.per_consumer||[]).forEach(c=>{const tr=document.createElement('tr');tr.innerHTML=`<td><b>${c.consumer||'-'}</b></td><td>${c.used_total||0}</td>`;ct.appendChild(tr)})}
$('#refreshStats').onclick=loadStats;
async function loadUsers(){const from=$('#fromDate').value,to=$('#toDate').value;const sum=await api(`/v1/owner_summary?date_from=${from}&date_to=${to}`);const byOwner={};(sum.owners||[]).forEach(o=>byOwner[o.owner]=o);const usedSelf={},usedOther={};(sum.consumers||[]).forEach(c=>{const map=c.by_owner||{};Object.keys(map).forEach(owner=>{const cnt=map[owner]||0;if(c.consumer===owner){usedSelf[owner]=(usedSelf[owner]||0)+cnt}else{usedOther[owner]=(usedOther[owner]||0)+cnt}})});
  const tb=$('#usersTable tbody');tb.innerHTML='';Object.keys(byOwner).sort().forEach(owner=>{const o=byOwner[owner];const tr=document.createElement('tr');tr.innerHTML=`<td><b>${owner}</b></td><td>${o.uploaded||0}</td><td>${o.unused||0}</td><td>${o.used_total||0}</td><td>${o.locked||0}</td><td>${o.reg_success||0}</td><td>${o.code_282||0}</td><td>${usedSelf[owner]||0}</td><td>${usedOther[owner]||0}</td>`;tb.appendChild(tr)})}
$('#refreshUsers').onclick=loadUsers;
let _saveTimers={}; function queueSave(kid,payload){clearTimeout(_saveTimers[kid]);_saveTimers[kid]=setTimeout(async()=>{await api('/v1/admin/update_key',{method:'POST',body:JSON.stringify(Object.assign({key_id:kid},payload))});toast('Saved '+kid)},350)}
async function loadKeys(){const res=await api('/v1/admin/list_keys');const tb=$('#keysTable tbody');tb.innerHTML='';(res.keys||[]).forEach(k=>{const tr=document.createElement('tr');tr.dataset.kid=k.key_id;tr.innerHTML=`<td><b>${k.key_id}</b></td>
<td><input data-f="label" value="${k.label||''}" style="width:160px"/></td>
<td><input type="checkbox" data-f="active" ${k.active?'checked':''}></td>
<td><input type="checkbox" data-f="can_upload" ${k.can_upload?'checked':''}></td>
<td><input type="checkbox" data-f="can_consume" ${k.can_consume?'checked':''}></td>
<td><input data-f="rpm_limit" value="${k.rpm_limit||0}" style="width:80px"/></td>
<td><input data-f="daily_cap" value="${k.daily_cap||0}" style="width:90px"/></td>
<td class="muted">${(k.created_at||'').replace('T',' ').slice(0,19)}</td>
<td><button class="btn small" data-act="copy">Copy Key</button> <button class="btn small" data-act="rotate">Rotate</button> <button class="btn small" data-act="del">Delete</button></td>`;tb.appendChild(tr)});
  tb.querySelectorAll('input[type="checkbox"][data-f]').forEach(ch=>ch.onchange=(e)=>{const tr=e.target.closest('tr');const kid=tr.dataset.kid;const f=e.target.dataset.f;queueSave(kid,{[f]:e.target.checked?1:0})});
  tb.querySelectorAll('input[data-f="label"]').forEach(inp=>inp.oninput=(e)=>{const tr=e.target.closest('tr');queueSave(tr.dataset.kid,{label:e.target.value})});
  ['rpm_limit','daily_cap'].forEach(f=>{tb.querySelectorAll(`input[data-f="${f}"]`).forEach(inp=>{inp.oninput=(e)=>{const tr=e.target.closest('tr');let v=parseInt(e.target.value||'0',10)||0;queueSave(tr.dataset.kid,{[f]:v})};})});
  tb.querySelectorAll('button[data-act="copy"]').forEach(b=>b.onclick=async(e)=>{const kid=e.target.closest('tr').dataset.kid;const r=await api('/v1/admin/show_secret',{method:'POST',body:JSON.stringify({key_id:kid})});await navigator.clipboard.writeText(r.api_key||(r.key_id+'.'+r.secret));toast('Key copied')});
  tb.querySelectorAll('button[data-act="rotate"]').forEach(b=>b.onclick=async(e)=>{const kid=e.target.closest('tr').dataset.kid;if(!confirm(`Rotate secret for ${kid}?`))return;const r=await api('/v1/admin/regen_secret',{method:'POST',body:JSON.stringify({key_id:kid})});await navigator.clipboard.writeText(r.api_key);toast('New key copied')});
  tb.querySelectorAll('button[data-act="del"]').forEach(b=>b.onclick=async(e)=>{const kid=e.target.closest('tr').dataset.kid;if(!confirm(`Delete key ${kid}?`))return;await api('/v1/admin/delete_key',{method:'POST',body:JSON.stringify({key_id:kid})});loadKeys()});
  $('#keySearch').oninput=(e)=>{const q=(e.target.value||'').toLowerCase();Array.from(document.querySelectorAll('#keysTable tbody tr')).forEach(r=>{const t=r.dataset.kid.toLowerCase()+' '+(r.querySelector('[data-f="label"]').value||'').toLowerCase();r.style.display=t.includes(q)?'':'none'})};
}
$('#btnCreateKey').onclick=async()=>{const p={key_id:$('#newKeyId').value.trim(),label:$('#newKeyLabel').value.trim()};if(!p.key_id){toast('key_id required');return;}await api('/v1/admin/create_key',{method:'POST',body:JSON.stringify(p)});
  const upd={key_id:p.key_id,active:$('#newActive').checked?1:0,can_upload:$('#newUpload').checked?1:0,can_consume:$('#newConsume').checked?1:0,rpm_limit:parseInt($('#newRPM').value||'0',10),daily_cap:parseInt($('#newDaily').value||'0',10)};await api('/v1/admin/update_key',{method:'POST',body:JSON.stringify(upd)});loadKeys();toast('Key created')};
async function loadGrants(){const keys=await api('/v1/admin/list_keys');const grants=await api('/v1/admin/list_grants');const owners=keys.keys.map(k=>k.key_id);const consumers=owners.slice();const matrix={};(grants.grants||[]).forEach(g=>{if(!matrix[g.consumer_key_id])matrix[g.consumer_key_id]={};matrix[g.consumer_key_id][g.owner_key_id]=!!g.enabled});
  const box=$('#grantsMatrix');const tbl=document.createElement('table');const thead=document.createElement('thead');let h='<tr><th>Consumer \\ Owner</th>';owners.forEach(o=>h+=`<th>${o}</th>`);h+='</tr>';thead.innerHTML=h;tbl.appendChild(thead);
  const tbody=document.createElement('tbody');consumers.forEach(c=>{const tr=document.createElement('tr');let row=`<td><b>${c}</b></td>`;owners.forEach(o=>{const chk=matrix[c]?.[o]?'checked':'';row+=`<td style="text-align:center"><input type="checkbox" data-c="${c}" data-o="${o}" ${chk}></td>`});tr.innerHTML=row;tbody.appendChild(tr)});tbl.appendChild(tbody);box.innerHTML='';box.appendChild(tbl);
  box.querySelectorAll('input[type="checkbox"]').forEach(ch=>ch.onchange=async(e)=>{const c=e.target.dataset.c,o=e.target.dataset.o;if(e.target.checked){await api('/v1/admin/grant',{method:'POST',body:JSON.stringify({consumer_key_id:c,owner_key_id:o,enabled:1})})}else{await api('/v1/admin/revoke',{method:'POST',body:JSON.stringify({consumer_key_id:c,owner_key_id:o})})}})}
let _relTimer=null; function setupAutoRelease(){const on=storage.getItem('auto_rel')==='1';const mins=parseInt(storage.getItem('auto_rel_mins')||'10',10)||10;$('#autoRel').checked=on;$('#relMin').value=mins;if(_relTimer)clearInterval(_relTimer);if(on){_relTimer=setInterval(()=>{api(`/v1/admin/release_pending_older_than?minutes=${$('#relMin').value||10}`,{method:'POST'})},mins*60*1000)}}
$('#autoRel').onchange=()=>{storage.setItem('auto_rel',$('#autoRel').checked?'1':'0');setupAutoRelease()}; $('#relMin').onchange=()=>{storage.setItem('auto_rel_mins',$('#relMin').value||'10');setupAutoRelease()};
$('#btnRelease').onclick=async()=>{const m=parseInt($('#relMin').value||'10',10);const r=await api(`/v1/admin/release_pending_older_than?minutes=${m}`,{method:'POST'});toast(`Released ${r.released||0}`)};
$('#btnMark').onclick=async()=>{const status=$('#markStatus').value,id=($('#markId').value||'').trim(),email=($('#markEmail').value||'').trim();const q=new URLSearchParams({status});if(id)q.set('id',id);if(email)q.set('email',email);const r=await api(`/v1/mark?${q.toString()}`);toast(`Marked ${r.id||''} as ${r.status||status}`)};
const EP=[
  {m:'POST',p:'/v1/admin/login',d:'Admin email+password login',ex:`curl -s -X POST $HOST/v1/admin/login -H 'Content-Type: application/json' -d '{"+"""+"email"+"""+":"+"""+"you@mail.com"+"""+","+"""+"password"+"""+":"+"""+"pass"+"""+"}'`},
  {m:'GET',p:'/v1/stats?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD',d:'Totals + per_owner + per_consumer',ex:`curl -s -H 'X-API-Key: $T' $HOST/v1/stats?date_from=2025-01-01&date_to=2025-12-31`},
  {m:'GET',p:'/v1/owner_summary?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD',d:'Owner/consumer summary',ex:`curl -s -H 'X-API-Key: $T' $HOST/v1/owner_summary?date_from=2025-01-01&date_to=2025-12-31`},
  {m:'GET',p:'/v1/admin/list_keys',d:'List keys',ex:`curl -s -H 'X-API-Key: $T' $HOST/v1/admin/list_keys`},
  {m:'POST',p:'/v1/admin/create_key',d:'Create key',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/create_key -d '{"+"""+"key_id"+"""+":"+"""+"demo"+"""+","+"""+"label"+"""+":"+"""+"Demo"+"""+"}'`},
  {m:'POST',p:'/v1/admin/update_key',d:'Update flags/limits',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/update_key -d '{"+"""+"key_id"+"""+":"+"""+"demo"+"""+","+"""+"active"+"""+":1,"+"""+"can_upload"+"""+":1,"+"""+"can_consume"+"""+":1,"+"""+"rpm_limit"+"""+":60,"+"""+"daily_cap"+"""+":5000}'`},
  {m:'POST',p:'/v1/admin/show_secret',d:'Copy full API key',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/show_secret -d '{"+"""+"key_id"+"""+":"+"""+"demo"+"""+"}'`},
  {m:'POST',p:'/v1/admin/regen_secret',d:'Rotate secret',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/regen_secret -d '{"+"""+"key_id"+"""+":"+"""+"demo"+"""+"}'`},
  {m:'POST',p:'/v1/admin/delete_key',d:'Delete key',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/delete_key -d '{"+"""+"key_id"+"""+":"+"""+"demo"+"""+"}'`},
  {m:'GET',p:'/v1/admin/list_grants',d:'Grants matrix',ex:`curl -s -H 'X-API-Key: $T' $HOST/v1/admin/list_grants`},
  {m:'POST',p:'/v1/admin/grant',d:'Grant consumer→owner',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/grant -d '{"+"""+"consumer_key_id"+"""+":"+"""+"demo"+"""+","+"""+"owner_key_id"+"""+":"+"""+"sanjay"+"""+","+"""+"enabled"+"""+":1}'`},
  {m:'POST',p:'/v1/admin/revoke',d:'Revoke grant',ex:`curl -s -X POST -H 'X-API-Key: $T' -H 'Content-Type: application/json' $HOST/v1/admin/revoke -d '{"+"""+"consumer_key_id"+"""+":"+"""+"demo"+"""+","+"""+"owner_key_id"+"""+":"+"""+"sanjay"+"""+"}'`},
  {m:'POST',p:'/v1/admin/release_pending_older_than?minutes=N',d:'Release pending > N min',ex:`curl -s -X POST -H 'X-API-Key: $T' $HOST/v1/admin/release_pending_older_than?minutes=10`},
  {m:'GET',p:'/v1/keys/me',d:'About current consumer/owner key',ex:`curl -s -H 'X-API-Key: $OWNER_KEY' $HOST/v1/keys/me`},
  {m:'GET',p:'/v1/fetch?limit=N',d:'Fetch accounts (consumer)',ex:`curl -s -H 'X-API-Key: $CONSUMER_KEY' $HOST/v1/fetch?limit=10`},
  {m:'POST',p:'/v1/upload',d:'Upload accounts (owner)',ex:`curl -s -H 'X-API-Key: $OWNER_KEY' -F 'file=@accounts.txt' $HOST/v1/upload`},
  {m:'GET',p:'/v1/mark?status=success|code_282|locked&id=...|email=...',d:'Mark account',ex:`curl -s -H 'X-API-Key: $T' '$HOST/v1/mark?status=success&id=123'`},
  {m:'GET',p:'/healthz',d:'Health',ex:`curl -s $HOST/healthz`}
];
function renderDocs(){const el=$('#docsBox');const host=location.origin;const t=xKey()?'$T':'admin_token_here';let H='';H+=`<div class="muted" style="margin-bottom:8px">Use <span class="code">export HOST=${host}</span> and <span class="code">export T=&lt;admin_token&gt;</span>.</div>`;
  EP.forEach(e=>{const ex=e.ex.replace('$HOST',host).replace('$T',t);H+=`<div style="margin:10px 0"><b>${e.m}</b> <span class="code">${e.p}</span><div class="muted" style="margin-top:2px">${e.d}</div><div class="row" style="margin-top:6px"><button class="btn small" data-copy="${ex.replace(/"/g,'&quot;')}">Copy</button></div><div class="code" style="margin-top:6px">${ex}</div></div>`});el.innerHTML=H;el.querySelectorAll('button[data-copy]').forEach(b=>b.onclick=async()=>{await navigator.clipboard.writeText(b.getAttribute('data-copy').replace(/&quot;/g,'"'));toast('Copied')})}
async function refreshAll(){await Promise.allSettled([loadStats(),loadUsers(),loadKeys(),loadGrants()]);renderDocs();setupAutoRelease()}
function setupAutoRelease(){const on=storage.getItem('auto_rel')==='1';const mins=parseInt(storage.getItem('auto_rel_mins')||'10',10)||10;$('#autoRel').checked=on;$('#relMin').value=mins; if(window._relTimer)clearInterval(window._relTimer); if(on){window._relTimer=setInterval(()=>{api(`/v1/admin/release_pending_older_than?minutes=${$('#relMin').value||10}`,{method:'POST'})},mins*60*1000)}}
if(xKey()){setKey(xKey());refreshAll()}
pages.docs.addEventListener('click',renderDocs);
</script></body></html>
